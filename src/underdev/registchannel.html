<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>LINE自動配信ツール</title>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';">
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="form.css">
    <script src="maketable.min.js"></script>
  </head>
  <body>
    <h2>チャネル登録</h2>
    <div class="cp_iptxt">
      <label class="ef">
        <input type="text" name="channelname" id="channelname" placeholder="チャネル名">
      </label>
    </div>
    <div id="regbtn" class="buttonarea">
      <button class="button-g" value="register" onclick="register()">チャネル登録</button>
    </div>
    <div class="buttonarea">
      <button class="button-g button-4" value="back" onclick="history.back()">戻る</button>
    </div>
    <script>
      // チャネル名
      const channelnameDom = document.getElementById('channelname');

      // チャネル登録完了
      window.api.on("channel_register_finish", arg => {
        try {
          // メッセージオプション
          const messageOption = {
            title: "登録完了",
            message: "登録が完了しました",
            type: "info",
          }
          window.api.send("showmessage", messageOption);
          // フォームクリア
          channelnameDom.value = "";

        } catch(e) {
          // エラー処理
          console.log(e);
        }
      });

      // ページ遷移
      const transfer = channel => {
        try {
          // 配信ページ遷移
          window.api.send("page", channel);

        } catch(e) {
          // エラー処理
          console.log(e);
        }
      }

      // プラン登録
      const register = () => {
        try {
          // エラーフラグ
          let errorflg;
          // エラーメッセージ
          let errorArray = [];
          // チャネル名
          const channelname = channelnameDom.value;

          /* バリデーション */
          // チャネル名
          if (channelname == "") {
            errorArray.push("チャネル名が空欄です");
            errorflg = true;
          }
          
          // エラーなし
          if (!errorflg) {
            // 配信モード
            window.api.send("channelregister", channelname);

          } else {
            // メッセージオプション
            const messageOption = {
              title: "エラー",
              message: errorArray.join("|"),
              type: "error",
            }
            window.api.send("showmessage", messageOption);
          }
        
        } catch(e) {
          // エラー処理
          window.api.send("error", e);
        }
      }

      // セレクトボックス変更
      const typechange = obj => {
        // 選択インデックス
        const idx = obj.selectedIndex;
        // 値
        const value = obj.options[idx].value;
      
        // 値とテキストをコンソールに出力
        if (value == "" || value == "text") {
          imagebtnDom.style.display ="none";

        } else {
          imagebtnDom.style.display ="block";
        }
      }
    </script>
  </body>
</html>
